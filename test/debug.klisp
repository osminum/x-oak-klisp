(def histo-test-set
  (list 9 0 5 3 1 8 8 4 2 2 7 5 7 7 1 8
        7 7 5 1 5 8 4 1 3 6 0 2 8 6 5 6
        7 0 3 6 6 6 1 3 0 3 5 0 0 7 1 3
        1 0 0 5 3 4 5 1 0 1 5 8 6 5 1 7
        4 2 6 4 9 6 3 1 3 3 8 5 7 8 6 9
        7 5 3 5 4 1 8 6 0 8 7 3 4 4 6 7
        7 5 9 6))

(def tests
  (deftestgroup 'debug'
    (deftest 'bar n = 0'
      (debug/bar 0)
      '')
    (deftest 'bar n < 0'
      (debug/bar -10)
      '')
    (deftest 'bar n = tiny fraction close to zero'
      (debug/bar 0.0001)
      '▏')
    (deftest 'bar n = 1'
      (debug/bar 1)
      '█')
    (deftest 'bar n = 2.5 (exact fraction-of-8)'
      (debug/bar 2.5)
      '██▌')
    (deftest 'bar n = 3.3333 (inexact fraction)'
      (debug/bar 3.3333)
      '███▍')
    (deftest 'bar n = 1.98 (check rounding)'
      (debug/bar 1.98)
      '██')
    (deftest 'bar n = 1000 (very long)'
      (len (debug/bar 1000))
      (* (len '█') 1000))

    (deftest 'empty histogram'
      (debug/histo nil)
      '')
    (deftest 'basic histogram'
      (debug/histo histo-test-set)
      (-> (list '█████████████████████████████████████████████████████████▏'
                '████████████████████████████████████████████████████████████████████▋'
                '██████████████████████▉'
                '████████████████████████████████████████████████████████████████████▋'
                '█████████████████████████████████████████████▊'
                '████████████████████████████████████████████████████████████████████████████████'
                '██████████████████████████████████████████████████████████████████████████▎'
                '██████████████████████████████████████████████████████████████████████████▎'
                '█████████████████████████████████████████████████████████▏'
                '')
          (join '\n')))
    (deftest 'histogram with bars = 0 (falls back to 1)'
      (debug/histo histo-test-set 1)
      '████████████████████████████████████████████████████████████████████████████████')
    (deftest 'histogram with bars < 0 (falls back to 1)'
      (debug/histo histo-test-set -2)
      '████████████████████████████████████████████████████████████████████████████████')
    (deftest 'histogram with bars = 5'
      (debug/histo histo-test-set 5)
      (-> (list '███████████████████████████████████████████████████████████████████▊'
                '█████████████████████████████████████████████████▎'
                '███████████████████████████████████████████████████████████████████▊'
                '████████████████████████████████████████████████████████████████████████████████'
                '██████████████████████████████▊')
          (join '\n')))
    (deftest 'histogram with cols = 10'
      (debug/histo histo-test-set 10 10)
      (-> (list '███████▏'
                '████████▋'
                '██▉'
                '████████▋'
                '█████▊'
                '██████████'
                '█████████▎'
                '█████████▎'
                '███████▏'
                '')
          (join '\n')))))

